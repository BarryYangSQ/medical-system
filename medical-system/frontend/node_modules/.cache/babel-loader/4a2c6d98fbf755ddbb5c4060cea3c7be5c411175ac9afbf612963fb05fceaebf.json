{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useDispatch,useSelector}from'react-redux';import{Link,useParams,useNavigate}from'react-router-dom';import{Row,Col,Image,ListGroup,Card,Button,Form}from'react-bootstrap';import{listStaffDetails}from'../actions/staffAction';import Rating from'../components/Rating';import Loader from'../components/Loader';import Message from'../components/Message';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const StaffScreen=()=>{var _availableTimes$find,_availableTimes$find2;// State for available times and selected date/slot\nconst[availableTimes,setAvailableTimes]=useState([]);const[selectedDate,setSelectedDate]=useState('');const[selectedSlot,setSelectedSlot]=useState('');const navigate=useNavigate();const dispatch=useDispatch();const{id}=useParams();const staffDetails=useSelector(state=>state.staffDetails);const{loading,error,staff}=staffDetails;// Handle fetching staff details\nuseEffect(()=>{dispatch(listStaffDetails(id));},[dispatch,id]);// Update available times when staff details are fetched\nuseEffect(()=>{if(staff&&staff.availableTimes){setAvailableTimes(staff.availableTimes.map(time=>({date:time.date.slice(0,10),// Use just the date part for comparison\nslots:time.slots})));}},[staff]);//添加预约\nconst addToAppointmentHandler=()=>{navigate(\"/preappointment/\".concat(id,\"?date=\").concat(encodeURIComponent(selectedDate),\"&slot=\").concat(encodeURIComponent(selectedSlot)));};const selectDate=date=>{setSelectedDate(date);setSelectedSlot('');// Reset slot when a new date is selected\n};const selectSlot=slot=>{setSelectedSlot(slot);};// Handle date change\nconst handleDateChange=e=>{const newDate=e.target.value;setSelectedDate(newDate);// Reset selected slot\nsetSelectedSlot('');};// Filter slots for the selected date\nconst availableSlots=((_availableTimes$find=availableTimes.find(time=>time.date===selectedDate))===null||_availableTimes$find===void 0?void 0:_availableTimes$find.slots)||[];return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Link,{className:\"btn btn-dark my-3\",to:\"/\",children:\"Go Back to Homepage\"}),loading?/*#__PURE__*/_jsx(Loader,{}):error?/*#__PURE__*/_jsx(Message,{variant:\"danger\",children:error}):/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsx(Image,{src:staff.image,alt:staff.name,fluid:true})}),/*#__PURE__*/_jsx(Col,{md:3,children:/*#__PURE__*/_jsxs(ListGroup,{variant:\"flush\",children:[/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsx(\"h3\",{children:staff.name})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:staff.rating&&/*#__PURE__*/_jsx(Rating,{value:staff.rating,text:\"\".concat(staff.numReviews,\"  reviews\")})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsx(\"h4\",{children:staff.position})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsx(\"h4\",{children:staff.department})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(\"h5\",{children:staff.description})})})]})}),/*#__PURE__*/_jsx(Col,{md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(ListGroup,{variant:\"flush\",children:[/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Available Dates\"}),/*#__PURE__*/_jsx(Row,{children:availableTimes.map((time,index)=>/*#__PURE__*/_jsx(Col,{xs:6,md:4,children:/*#__PURE__*/_jsx(Button,{variant:selectedDate===time.date?'success':'outline-primary',onClick:()=>selectDate(time.date),children:time.date})},index))})]}),/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Available Slots\"}),/*#__PURE__*/_jsx(Row,{children:selectedDate&&((_availableTimes$find2=availableTimes.find(time=>time.date===selectedDate))===null||_availableTimes$find2===void 0?void 0:_availableTimes$find2.slots.map((slot,index)=>/*#__PURE__*/_jsx(Col,{xs:6,children:/*#__PURE__*/_jsx(Button,{variant:selectedSlot===slot?'success':'outline-secondary',onClick:()=>selectSlot(slot),disabled:!selectedDate,children:slot})},index)))})]}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsx(Button,{onClick:addToAppointmentHandler,className:\"btn-block\",type:\"button\",disabled:!selectedSlot,children:\"\\u6DFB\\u52A0\\u5230\\u9884\\u7EA6\"})})]})})})]})]});};export default StaffScreen;","map":{"version":3,"names":["React","useEffect","useState","useDispatch","useSelector","Link","useParams","useNavigate","Row","Col","Image","ListGroup","Card","Button","Form","listStaffDetails","Rating","Loader","Message","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","StaffScreen","_availableTimes$find","_availableTimes$find2","availableTimes","setAvailableTimes","selectedDate","setSelectedDate","selectedSlot","setSelectedSlot","navigate","dispatch","id","staffDetails","state","loading","error","staff","map","time","date","slice","slots","addToAppointmentHandler","concat","encodeURIComponent","selectDate","selectSlot","slot","handleDateChange","e","newDate","target","value","availableSlots","find","children","className","to","variant","md","src","image","alt","name","fluid","Item","rating","text","numReviews","position","department","description","index","xs","onClick","disabled","type"],"sources":["C:/Users/陈云林/Desktop/health/health-project/frontend/src/screens/StaffScreen.js"],"sourcesContent":["import React, { useEffect, useState } from 'react'\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport { Link, useParams, useNavigate } from 'react-router-dom'\r\nimport {\r\n  Row,\r\n  Col,\r\n  Image,\r\n  ListGroup,\r\n  Card,\r\n  Button,\r\n  Form,\r\n} from 'react-bootstrap'\r\nimport { listStaffDetails } from '../actions/staffAction'\r\nimport Rating from '../components/Rating'\r\nimport Loader from '../components/Loader'\r\nimport Message from '../components/Message'\r\n\r\nconst StaffScreen = () => {\r\n  // State for available times and selected date/slot\r\n  const [availableTimes, setAvailableTimes] = useState([])\r\n  const [selectedDate, setSelectedDate] = useState('')\r\n  const [selectedSlot, setSelectedSlot] = useState('')\r\n  const navigate = useNavigate()\r\n  const dispatch = useDispatch()\r\n  const { id } = useParams()\r\n  const staffDetails = useSelector((state) => state.staffDetails)\r\n  const { loading, error, staff } = staffDetails\r\n  // Handle fetching staff details\r\n  useEffect(() => {\r\n    dispatch(listStaffDetails(id))\r\n  }, [dispatch, id])\r\n\r\n  // Update available times when staff details are fetched\r\n  useEffect(() => {\r\n    if (staff && staff.availableTimes) {\r\n      setAvailableTimes(staff.availableTimes.map((time) => ({\r\n        date: time.date.slice(0, 10), // Use just the date part for comparison\r\n        slots: time.slots,\r\n      })))\r\n    }\r\n  }, [staff])\r\n\r\n  //添加预约\r\n  const addToAppointmentHandler = () => {\r\n    navigate(`/preappointment/${id}?date=${encodeURIComponent(selectedDate)}&slot=${encodeURIComponent(selectedSlot)}`)\r\n  }\r\n\r\n  const selectDate = (date) => {\r\n    setSelectedDate(date)\r\n    setSelectedSlot('') // Reset slot when a new date is selected\r\n  }\r\n\r\n  const selectSlot = (slot) => {\r\n    setSelectedSlot(slot)\r\n  }\r\n\r\n\r\n  // Handle date change\r\n  const handleDateChange = (e) => {\r\n    const newDate = e.target.value\r\n    setSelectedDate(newDate)\r\n    // Reset selected slot\r\n    setSelectedSlot('')\r\n  }\r\n\r\n  // Filter slots for the selected date\r\n  const availableSlots = availableTimes.find(time => time.date === selectedDate)?.slots || []\r\n\r\n\r\n\r\n  return (\r\n    <>\r\n      <Link className='btn btn-dark my-3' to='/'>\r\n        Go Back to Homepage\r\n      </Link>\r\n      {loading ? (\r\n        <Loader />\r\n      ) : error ? (\r\n        <Message variant='danger'>{error}</Message>\r\n      ) : (\r\n        <Row>\r\n          <Col md={6}>\r\n            <Image src={staff.image} alt={staff.name} fluid />\r\n          </Col>\r\n          <Col md={3}>\r\n            <ListGroup variant='flush'>\r\n              <ListGroup.Item>\r\n                <h3>{staff.name}</h3>\r\n              </ListGroup.Item>\r\n              <ListGroup.Item>\r\n                {staff.rating && (\r\n                  <Rating\r\n                    value={staff.rating}\r\n                    text={`${staff.numReviews}  reviews`}\r\n                  />\r\n                )}\r\n              </ListGroup.Item>\r\n              <ListGroup.Item><h4>{staff.position}</h4></ListGroup.Item>\r\n              <ListGroup.Item><h4>{staff.department}</h4></ListGroup.Item>\r\n              <ListGroup.Item>\r\n\r\n                <Row><h5>{staff.description}</h5></Row>\r\n              </ListGroup.Item>\r\n            </ListGroup>\r\n          </Col>\r\n          <Col md={3}>\r\n            <Card>\r\n              <ListGroup variant='flush'>\r\n                {/* ... */}\r\n                <ListGroup.Item>\r\n                  <h4>Available Dates</h4>\r\n                  <Row>\r\n                    {availableTimes.map((time, index) => (\r\n                      <Col key={index} xs={6} md={4}>\r\n                        <Button variant={selectedDate === time.date ? 'success' : 'outline-primary'}\r\n                          onClick={() => selectDate(time.date)}>\r\n                          {time.date}\r\n                        </Button>\r\n                      </Col>\r\n                    ))}\r\n                  </Row>\r\n                </ListGroup.Item>\r\n                <ListGroup.Item>\r\n                  <h4>Available Slots</h4>\r\n                  <Row>\r\n                    {selectedDate && availableTimes.find(time => time.date === selectedDate)?.slots.map((slot, index) => (\r\n                      <Col key={index} xs={6}>\r\n                        <Button variant={selectedSlot === slot ? 'success' : 'outline-secondary'}\r\n                          onClick={() => selectSlot(slot)}\r\n                          disabled={!selectedDate}>\r\n                          {slot}\r\n                        </Button>\r\n                      </Col>\r\n                    ))}\r\n                  </Row>\r\n                </ListGroup.Item>\r\n                <ListGroup.Item>\r\n                  <Button onClick={addToAppointmentHandler}\r\n                    className='btn-block'\r\n                    type='button'\r\n                    disabled={!selectedSlot}>\r\n                    添加到预约\r\n                  </Button>\r\n                </ListGroup.Item>\r\n              </ListGroup>\r\n            </Card>\r\n          </Col>\r\n        </Row>\r\n      )}\r\n    </>\r\n  )\r\n}\r\n\r\nexport default StaffScreen\r\n\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}